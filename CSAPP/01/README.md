# 01. 计算机系统漫游

## 1.1 信息就是位+上下文
源程序实际上就是由0和1组成的位(又称比特)序列，8位组成一个字节，每个字节表示程序中的某个文本字符。只由ASCII构成的文件称为文本文件，其他所有文件都是二进制文件。

系统中的所有信息，包括磁盘文件、内存中的程序、内存中存放的数据和网络传输的数据，都是由一串比特组成的。区分这些不同数据对象的唯一方法是根据读到这些数据对象时的上下文(context)。在不同的上下文中，一个同样的字节序列可能表示一个整数、浮点数、字符串或机器指令。

## 1.2 编译系统是如何工作的
为了在操作系统上运行一个高级语言程序，程序的每条语句都必须被转化为一系列低级的机器语言指令。然后将这些指令按照可执行目标程序的格式打包，并以二进制磁盘文件的形式存放。在Unix系统上，这个过程是由编译器驱动程序完成的。

将源文件翻译成可执行目标文件，分为四个阶段完成，分别是预处理器、编译器、汇编器、链接器，它们一起构成了编译系统。

- 预处理阶段。 预处理器修改原始程序，读取其依赖的头文件，并直接插入程序文本中。
- 编译阶段。 编译器将预处理后的文本文件翻译成汇编语言程序。
- 汇编阶段。 汇编器将汇编语言程序翻译成机器语言指令，并将指令打包成可重定位目标程序的格式，将结果保存在.o文件中。
- 链接阶段。 链接器负责合并程序所依赖的库文件(.o)，得到一个可执行目标文件。

## 1.3 处理器是如何工作的
典型系统的硬件组织由如下几部分构成。
1. 总线
贯穿整个系统的是一组电子管道，称为总线，它携带信息字节并负责在各个部件间传递。通常被设计成传送定长的字节快，64位操作系统普遍为8字节。
2. I/O设备
I/O设备是系统与外部世界的联系通道。如鼠标、键盘、显示器、磁盘等。每个I/O设备都通过一个控制器或适配器与I/O总线相连，用于在I/O总线和I/O设备之间传递信息
3. 主存
主存是一个临时存储设备，在处理器执行程序时，用来存放程序和程序处理的数据。从物理上来说，是由一组动态随机存取存储器芯片组成的。从逻辑上来说，存储器是一个线性的字节数组，每个字节有唯一的地址。
4. 处理器
中央处理单元(CPU)，简称处理器。是执行存储在主存中指令的引擎。其核心是一个大小为一个字节快的存储设备(寄存器)，称为程序计数器(PC)。在任何时刻，PC都指向主存中的某条机器语言指令。

处理器从PC指向的内存处读取指令，执行该指令，然后更新PC，使其指向下一条指令，这条指令不一定在内存中和刚刚执行的指令相邻。

这样的操作围绕着主存、寄存器文件和算数/逻辑单元(ALU)进行。寄存器文件是一个小的存储设备，由寄存器组成。ALU计算新的数据和地址值。下面是一些简单操作的例子，CPU在指令的要求下可能会执行这些操作。
- 加载。 从主存复制一个字到寄存器，覆盖寄存器原来的内容。
- 存储。 从寄存器复制一个字到主存的某个位置上，覆盖这个位置原来的内容。
- 操作。 把两个寄存器的内容复制到ALU，ALU对其做算术运算，并将结果存放到一个寄存器中，覆盖寄存器原来的内容。
- 跳转。 从指令本身抽取一个字，并将这个字复制到PC中，覆盖PC中原来的值。

当运行一个可执行文件时，磁盘上的可执行文件通过I/O桥加载到主存储器，处理器执行程序中的机器语言指令，将数据字节从主存复制到寄存器文件，再从寄存器文件复制到显示设备，最终显示在屏幕上。

![典型系统硬件组织](images/01.png)

## 1.4 高速缓存
观察运行一个可执行文件时的流程，发现系统花费了大量时间把信息从一个地方挪到另一个地方。最初程序的机器指令放在磁盘，加载时被复制到主存，处理器运行程序时，指令又从主存复制到处理器。这些复制就是开销，减慢了工作效率。

根据机械原理，较大的存储设备比较小的存储设备运行的慢，但造价低。处理器从寄存器文件中读数据要比从主存中读取快上百倍。针对这种差异，系统设计者采用了更小更快的存储设备，称为高速缓存(cache)，作为暂时的集结区，存放处理器近期可能需要的信息。利用高速缓存的局部性原理，即程序具有访问局部区域里的数据和代码的趋势，让高速缓存中存放可能经常访问的数据，大部分的内存操作都能在高速缓存中完成。利用高速缓存，能将程序的性能提高一个数量级。

![高速缓存](images/02.png)

## 1.5 存储器层次结构
存储器层次结构的主要思想是上一层的存储器作为低一层存储器的高速缓存。因此，寄存器文件就是L1的高速缓存，L1是L2的高速缓存，L2是L3的高速缓存，L3是主存的高速缓存，主存是磁盘的高速缓存。

![存储器层次结构](images/03.png)